# Conversational System LLM

This project is a conversational system based on large language models (LLM) with tools that allows interaction with users through text and audio. It uses FastAPI for creating endpoints, langgraph and langchain to interact with Mistral and SQLAlchemy for database management.

## Project Description

The system allows users to interact with a language model through endpoints. Users can send text messages or audio files, and the system will respond with text or audio generated by the model or tools.

## Project Structure

```
app/
    __init__.py
    alembic.ini
    main.py
    agents/
    core/
    migrations/
    models/
    repositories/
    routers/
    schemas/
    services/
    tests/
docker-compose.yml
Dockerfile
entrypoint.sh
requirements.txt
```

## Dependencies

The project dependencies are listed in the `requirements.txt` file. To install them, you can use the following command:

```sh
pip install -r requirements.txt
```

## Usage with Docker

### Using Local Dockerfile

To run the project with Docker locally, follow these steps:

1. Build the Docker image:

```sh
docker-compose build
```

2. Start the services:

```sh
docker-compose up
```

This will start the database and application services in Docker containers.

### Using GitHub Container Registry

You can also pull and use the pre-built image from GitHub Container Registry:

1. Pull the image:

```sh
docker pull ghcr.io/cristian-sangucho-a/conversational-sistem-v1:latest
```

2. Create a `.env` file based on `.env.example` with your configuration settings

3. Use docker-compose: __See docker-compose.yml__

```yaml
# In your docker-compose.yml
services:
  app:
    image: ghcr.io/cristian-sangucho-a/conversational-sistem-v1:latest
    env_file:
      - .env
    ports:
      - "8000:8000"
    depends_on:
      - db
  db:
    # your database configuration
```

Then run:

```sh
docker-compose up
```


## Endpoints

### Chat Endpoints

- **POST /chat/audio/**: Send an audio file and receive an audio response.
  - Parameters:
    - `user_id`: User ID.
    - `conversation_id`: Conversation ID.
    - `file`: Audio file in WAV format.

- **POST /chat/text/**: Send a text message and receive a text response.
  - Parameters:
    - `chat_request`: JSON object with fields `message`, `user_id`, and `conversation_id`.

### Conversation Endpoints

- **POST /conversation/create/**: Create a new conversation.
  - Parameters:
    - `conversation`: JSON object with fields `user_id` and `title`.

### User Endpoints

- **POST /user/create/**: Create a new user.
  - Parameters:
    - `user`: JSON object with the field `username`.

## Database Configuration

The database configuration is located in the `.env` file. Make sure to configure the environment variables correctly before running the project.

## Database Migrations

Alembic is used to manage database migrations. Migration scripts are located in the `app/migrations` directory.

To apply the migrations, run the following command:
```sh
alembic upgrade head
```

## Running Tests

The project uses pytest for testing. To run the tests, you need to set the PYTHONPATH environment variable to include the app directory.

### Windows (PowerShell):

```powershell
$env:PYTHONPATH = "./app"; pytest -v
```

### Linux/macOS:

```bash
PYTHONPATH=./app pytest -v
```
